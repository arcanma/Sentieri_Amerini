<!doctype html>
<html lang="it">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="author" content="Marcello Arcangeli" />
    <link rel="stylesheet" href="css/leaflet.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/fontawesome.min.css" integrity="sha384-wESLQ85D6gbsF459vf1CiZ2+rr+CsxRY0RpiF1tLlQpDnAgg6rwdsUF1+Ics2bni" crossorigin="anonymous">
    <link rel="stylesheet" href="css/L.Control.Locate.min.css">
    <link rel="stylesheet" href="css/leaflet.elevation-0.0.4.css" />
    <link rel="stylesheet" href="css/leaflet-panel-layers.css" />
    <link rel="stylesheet" href="css/icons.css" />
    <link rel="stylesheet" href="css/style.css" />
    <script src="js/leaflet.js"></script>
    <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/leaflet.elevation-0.0.4.min.js"></script>
    <script src="js/gpx.js"></script>
    <script src="js/leaflet.rotatedMarker.js"></script>
    <script src="js/leaflet-hash.js"></script>
    <script src="js/L.Control.Locate.min.js"></script>
    <script src="js/Autolinker.min.js"></script>
    <script src="js/leaflet-panel-layers.min.js"></script>
    <script src="js/eventr.min.js"></script>
    <!-- GEOJSON DATA -->
    <script src="data/718_Sentiero-S.Angelo.js"></script>
    <script src="data/719_Sentiero-MontePiglio.js"></script>
    <script src="data/720_Amelia-Sambucetole.js"></script>
    <script src="data/721_Amelia-Collicello.js"></script>
    <script src="data/722_Sambucetole-Collicello.js"></script>
    <script src="data/723_Collicello-S.Restituta.js"></script>
    <script src="data/725_Perc.Collicello-breve.js"></script>
    <script src="data/726_Perc.Collicello-medio.js"></script>
    <script src="data/727_Perc.Collicello-lungo.js"></script>
    <script src="data/728_Amelia-Macchie.js"></script>
    <script src="data/729_Amelia-Macchie-Lugnano.js"></script>
    <script src="data/729A_Sentiero-ValleRignana.js"></script>
    <script src="data/729B.js"></script>
    <script src="data/730_Macchie-S.Restituta.js"></script>
    <script src="data/731_Amelia-Porchiano.js"></script>
    <script src="data/732_Porchiano-Lugnano.js"></script>
    <script src="data/733_Porchiano-Giove.js"></script>
    <script src="data/734_Trek.Urbano-Amelia.js"></script>
    <script src="data/735A.js"></script>
    <script src="data/735_Amelia-L.Vecchio-xValle.js"></script>
    <script src="data/735B_Amelia-L.Vecchio-xNocicchia.js"></script>
    <script src="data/736_Foce-Intersez_720.js"></script>
    <script src="data/737_Amelia-Fornole-Foce.js"></script>
    <script src="data/738_Conv.Annunziata-Giove.js"></script>
    <script src="data/739_Montecampano-Conv.Annunziata.js"></script>
    <script src="data/740_Fornole-Montecampano.js"></script>
    <script src="data/742_Foce-Montecampano.js"></script>
    <script src="data/743_Lugnano-PianiPeloni.js"></script>
    <script src="data/744_S.Restituta-Melezzole.js"></script>
    <script src="data/745_S.Restituta-Montecchio.js"></script>
    <script src="data/746_AltaVia-MontiAmerini.js"></script>
    <script src="data/747_Melezzole-Montecchio.js"></script>
    <script src="data/AnticaViaAmerina.js"></script>
    <script src="data/Cammino_Germanico.js"></script>
    <script src="data/C_BorghiSilenti.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
    html, body, #map {
        width: 100vw;
        height: 100%;
        padding: 0;
        margin: 0;
    }
    </style>
    <title>Sentieri Amerini</title>
</head>

<body>
    <div id="map">
    </div>

    <div id="feature_infos">
     <span id="info"></span>
    </div>

<script>
    var map = L.map('map', {
        zoomControl:true, maxZoom:20, minZoom:11
    }).fitBounds([[42.10,11.945],[43.05,12.78]]);
    map.setView(new L.LatLng(42.5935, 12.3857), 12);
    var hash = new L.Hash(map);
    L.control.locate().addTo(map);
    L.control.scale().addTo(map);
    osmLayer = new L.TileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: ' <a href="http://labs.easyblog.it/maps/leaflet-panel-layers/">PanelLayers</a> |  <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
        maxZoom: 19
    });
    landscapeLayer = new L.tileLayer('http://{s}.tile.thunderforest.com/landscape/{z}/{x}/{y}.png?apikey=9a0f6bee78fe4b999bd2dea060084527', {
        attribution: ' <a href="http://labs.easyblog.it/maps/leaflet-panel-layers/">PanelLayers</a> | Map tiles @ <a href="http://www.thunderforest.com">Thunderforest</a>, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
        maxZoom: 20
    });
    satelliteLayer = new L.tileLayer('https://api.maptiler.com/maps/hybrid/{z}/{x}/{y}.jpg?key=u9JazGCzsNLuMszKP0l7', {
    tileSize: 512, zoomOffset: -1, minZoom: 11, maxZoom: 20,
    attribution: ' <a href="http://labs.easyblog.it/maps/leaflet-panel-layers/">PanelLayers</a> | Map tiles @ <a href="https://www.maptiler.com/copyright/">MapTiler</a> | <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
    crossOrigin: true
    });
    satelliteLayer.addTo(map);
    map.attributionControl.addAttribution;
    map.createPane('elevazione');
    var el = L.control.elevation({
        pane: 'elevazione',
        position: "topleft",
        theme: "steelblue-theme",
        useHeightIndicator: true,
        collapsed: true,
    });

    function setBounds() {
        map.setMaxBounds(map.getBounds());
    };

    function style_percorsi() {
        return {
            opacity: 1,
            dashArray: '',
            lineCap: 'square',
            lineJoin: 'bevel',
            weight: 5.0,
            fillOpacity: 0,
        }
    }

    function highlightFeature(e) {
        highlightLayer = e.target;

        if (e.target.feature.geometry.type === 'LineString') {
          highlightLayer.setStyle({
            weight: 7.0,
          });
            var popup_info = "<nobr><b>" + e.target.feature.properties.name + "</b></nobr>";
            highlightLayer.bindPopup(popup_info, {closeButton: false, autoPan: false}).openPopup();
        }
    };

    function hide_info() {feature_infos.style.display= "none"};
    
    function close_info() {
        feature_infos.style.display= "none";
        document.getElementById("info").innerHTML = "";
        map.setView(new L.LatLng(42.5935, 12.3857), 12);
        for (var i = 0; i < 35; i++) {
            map.addLayer(overLayers[0].layers[i].layer);
        };
        if (document.activeElement.id !== "map") {
            document.getElementById('map').focus();
            Eventr.simulate(document.getElementById('map'),'click');
        };
        el.remove()
    };

    function selectFeature(e) {
        selectLayer = e.target;
        if (e.target.feature.geometry.type === 'LineString') {
            map.fitBounds(selectLayer.getBounds());

            el.addTo(map);
            for (var i = 0; i < 35; i++) {
                if ((overLayers[0].layers[i].name != e.target.feature.properties.name) && (map.hasLayer(overLayers[0].layers[i].layer))) {
                    map.removeLayer(overLayers[0].layers[i].layer);
                };
            };
            el.clear();

            var g=new L.GPX(e.target.feature.properties['gpx'], {async: true});
            g.on('loaded', function(e) {
                map.fitBounds(e.target.getBounds());
            });
            g.on("addline",function(e){
                el.addData(e.line);
            });
            selectLayer.setStyle({
            weight: 7.0,
          });

            var popup_info = "<img src='" + e.target.feature.properties.image + "' width='99%' height='75%'>" +
                "<nobr><b>" + e.target.feature.properties.name + "</b></nobr><br>" +
                (e.target.feature.properties['info-it'] != '' ? ('<a href="' + e.target.feature.properties['info-it'] + '" target="_blank">più informazioni</a>') : '') +
                "<img src='images/hide_16p.png' align='right' onclick='hide_info()'>" +             
                (e.target.feature.properties['gpx'] != '' ? ('<br><a href="' + e.target.feature.properties['gpx'] + '" download>traccia gpx</a>') : '') +             
                (e.target.feature.properties['kml'] != '' ? (' - <a href="' + e.target.feature.properties['kml'] + '" download>traccia kml</a>') : '') +
                "<img src='images/cancel_16p.png' align='right' onclick='close_info()'>" ;
                feature_infos.style.display= "flex";
                document.getElementById("info").innerHTML = popup_info;
            }
            else {
            var popup_info = null;
        };
    };

    function layer_events(feature, layer) {
        layer.on({
            mouseout: function(e) {
                for (i in e.target._eventParents) {
                    e.target._eventParents[i].resetStyle(e.target)
                };
            },
            mouseover: highlightFeature,
            click: selectFeature
        });
	};

    function iconByName(name) {
        return '<i class="icon icon-'+name+'"></i>';
    }

   var layer_percorso_01 = new L.geoJson(json_SA720, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);

    var layer_percorso_02 = new L.geoJson(json_SA721, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);

    var layer_percorso_03 = new L.geoJson(json_SA722, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);

    var layer_percorso_04 = new L.geoJson(json_SA723, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_05 = new L.geoJson(json_SA725, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		} 		
    );
    var layer_percorso_06 = new L.geoJson(json_SA726, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_07 = new L.geoJson(json_SA727, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_08 = new L.geoJson(json_SA728, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_09 = new L.geoJson(json_SA729, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_10 = new L.geoJson(json_SA729A, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_11 = new L.geoJson(json_SA729B, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_12 = new L.geoJson(json_SA730, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_13 = new L.geoJson(json_SA731, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_14 = new L.geoJson(json_SA732, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_15 = new L.geoJson(json_SA733, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_16 = new L.geoJson(json_SA734, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_17 = new L.geoJson(json_SA735, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_18 = new L.geoJson(json_SA735A, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_19 = new L.geoJson(json_SA735B, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_20 = new L.geoJson(json_SA736, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_21 = new L.geoJson(json_SA737, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_22 = new L.geoJson(json_SA738, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_23 = new L.geoJson(json_SA739, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_24 = new L.geoJson(json_SA740, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_25 = new L.geoJson(json_SA742, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_26 = new L.geoJson(json_SA743, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_27 = new L.geoJson(json_SA744, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_28 = new L.geoJson(json_SA745, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			}
        }
    );
    var layer_percorso_29 = new L.geoJson(json_SA746, {
		onEachFeature: layer_events,
        style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);
    var layer_percorso_30 = new L.geoJson(json_SA747, {
		onEachFeature: layer_events,
		style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);
    var layer_percorso_31 = new L.geoJson(json_SS718, {
		onEachFeature: layer_events,
		style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);
    var layer_percorso_32 = new L.geoJson(json_SS719, {
		onEachFeature: layer_events,
		style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);
    var layer_percorso_33 = new L.geoJson(json_AVA, {
		onEachFeature: layer_events,
		style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);
    var layer_percorso_34 = new L.geoJson(json_CG, {
		onEachFeature: layer_events,
		style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);
    var layer_percorso_35 = new L.geoJson(json_CBS, {
		onEachFeature: layer_events,
		style: style_percorsi,
        style: function(feature) {
			var col = feature.properties.color;
			return { color: col }; 
			} 
		}
	);

    var overLayers = [
        {
        group: "Percorsi",
        collapsed: true,
        layers: [
        {
            name: "718 Sentiero Sant'Angelo",
            icon: iconByName('percorsi'),
            layer: layer_percorso_31,
            active: true
        },
        {
            name: "719 Sentiero Monte Piglio",
            icon: iconByName('percorsi'),
            layer: layer_percorso_32,
            active: true
        },
        {
            name: "720 Amelia - Sambucetole",
            icon: iconByName('percorsi'),
            layer: layer_percorso_01,
            active: true
        },
        {
            name: "721 Amelia - Collicello",
            icon: iconByName('percorsi'),
            layer: layer_percorso_02,
            active: true
        },
        {
            name: "722 Sambucetole - Collicello",
            icon: iconByName('percorsi'),
            layer: layer_percorso_03,
            active: true
        },
        {
            name: "723 Collicello - Santa Restituta",
            icon: iconByName('percorsi'),
            layer: layer_percorso_04,
            active: true
        },
        {
            name: "725 Percorso di Collicello - breve",
            icon: iconByName('percorsi'),
            layer: layer_percorso_05,
            active: true
        },
        {
            name: "726 Percorso di Collicello - medio",
            icon: iconByName('percorsi'),
            layer: layer_percorso_06,
            active: true
        },
        {
            name: "727 Percorso di Collicello - lungo",
            icon: iconByName('percorsi'),
            layer: layer_percorso_07,
            active: true
        },
        {
            name: "728 Amelia - Macchie",
            icon: iconByName('percorsi'),
            layer: layer_percorso_08,
            active: true
        },
        {
            name: "729 Amelia - Macchie - Lugnano",
            icon: iconByName('percorsi'),
            layer: layer_percorso_09,
            active: true
        },
        {
            name: "729A Sentiero di Valle Rignana",
            icon: iconByName('percorsi'),
            layer: layer_percorso_10,
            active: true
        },
        {
            name: "729B Sentiero di Monte Pian di Nappa",
            icon: iconByName('percorsi'),
            layer: layer_percorso_11,
            active: true
        },
        {
            name: "730 Macchie - Santa Restituta",
            icon: iconByName('percorsi'),
            layer: layer_percorso_12,
            active: true
        },
        {
            name: "731 Amelia - Porchiano",
            icon: iconByName('percorsi'),
            layer: layer_percorso_13,
            active: true
        },
        {
            name: "732 Porchiano - Lugnano",
            icon: iconByName('percorsi'),
            layer: layer_percorso_14,
            active: true
        },
        {
            name: "733 Porchiano - Giove",
            icon: iconByName('percorsi'),
            layer: layer_percorso_15,
            active: true
        },
        {
            name: "734 Trekking urbano Amelia",
            icon: iconByName('percorsi'),
            layer: layer_percorso_16,
            active: true
        },
        {
            name: "735 Amelia - Lago Vecchio (per la Valle)",
            icon: iconByName('percorsi'),
            layer: layer_percorso_17,
            active: true
        },
        {
            name: "735A Variante di Porta Leone",
            icon: iconByName('percorsi'),
            layer: layer_percorso_18,
            active: true
        },
        {
            name: "735B Amelia - Lago Vecchio (per Nocicchia)",
            icon: iconByName('percorsi'),
            layer: layer_percorso_19,
            active: true
        },
        {
            name: "736 Foce - Intersezione 720",
            icon: iconByName('percorsi'),
            layer: layer_percorso_20,
            active: true
        },
        {
            name: "737 Amelia - Fornole - Foce",
            icon: iconByName('percorsi'),
            layer: layer_percorso_21,
            active: true
        },
        {
            name: "738 Convento dell'Annunziata - Giove",
            icon: iconByName('percorsi'),
            layer: layer_percorso_22,
            active: true
        },
        {
            name: "739 Montecampano - Convento Annunziata",
            icon: iconByName('percorsi'),
            layer: layer_percorso_23,
            active: true
        },
        {
            name: "740 Fornole - Montecampano",
            icon: iconByName('percorsi'),
            layer: layer_percorso_24,
            active: true
        },
        {
            name: "742 Foce - Montecampano",
            icon: iconByName('percorsi'),
            layer: layer_percorso_25,
            active: true
        },
        {
            name: "743 Lugnano - Piani Peloni",
            icon: iconByName('percorsi'),
            layer: layer_percorso_26,
            active: true
        },
        {
            name: "744 Santa Restituta - Melezzole",
            icon: iconByName('percorsi'),
            layer: layer_percorso_27,
            active: true
        },
        {
            name: "745 Santa Restituta - Montecchio",
            icon: iconByName('percorsi'),
            layer: layer_percorso_28,
            active: true
        },
        {
            name: "746 Alta Via dei Monti Amerini",
            icon: iconByName('percorsi'),
            layer: layer_percorso_29,
            active: true
        },
        {
            name: "747 Melezzole - Montecchio",
            icon: iconByName('percorsi'),
            layer: layer_percorso_30,
            active: true
        },
        {
            name: "Antica Via Amerina",
            icon: iconByName('percorsi'),
            layer: layer_percorso_33,
            active: true
        },
        {
            name: "Cammino di Germanico",
            icon: iconByName('percorsi'),
            layer: layer_percorso_34,
            active: true
        },
        {
            name: "Cammino dei Borghi Silenti",
            icon: iconByName('percorsi'),
            layer: layer_percorso_35,
            active: true
        },
        ]}
    ];

    var baseLayers = [
        {
            group: "Base Map",
            collapsed: true,
            layers: [
                {
                    name: "OpenStreetMap",
                    layer: osmLayer
                },
                {
                    name: "Thunderforest Landscape",
                    layer: landscapeLayer
                },
                {
                    name: "Satellite Hybrid",
                    layer: satelliteLayer
                }
            ]
        }
    ];

    var panelLayers = new L.Control.PanelLayers(baseLayers, overLayers, {
            compact: true,
            collapsibleGroups: true,
            collapsed: true
    });

    map.addControl(panelLayers);
    setBounds();

</script>
</body>
</html>
